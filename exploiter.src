// Check params
if params.len != 5 then
	if params.len != 4 or params[0] == "-h" or params[0] == "--help" then
		exit "Usage: " + program_path.split("/")[-1] + " [ip_address] [port] [memory_address] [zone]"
	end if
end if
// Need ip_address ; port ; memory address ; exploit zone

// Program start
clear_screen
print "--- Exploiter 1.0 ---"
// metaxploit lib
metaxploit = include_lib("/lib/metaxploit.so")
if not metaxploit then exit("Error: Missing metaxploit library in /lib")
// crypto lib
// crypto = include_lib("/lib/crypto.so");
// if not crypto then exit("Error: Missing crypto library");

address = params[0]
port = params[1].to_int
memoryAddress = params[2]
exploitZone = params[3]
newPwd = null
if params.len == 5 then newPwd = params[4]

// Connect to target
print "Attempt to connect to " + address + " on port " + port
netSession = metaxploit.net_use(address, port)
if not netSession then exit("Connection failed")
print "Connection established"

// Exploit
metalib = netSession.dump_lib
print "Attempt to exploit " + metalib.lib_name + ": " + exploitZone + " on " + memoryAddress
exploit = null
if newPwd == null then
	exploit = metalib.overflow(memoryAddress, exploitZone)
else
	exploit = metalib.overflow(memoryAddress, exploitZone, newPwd)
end if

print "Exploit type: " + typeof(exploit)
// if not exploit then exit("Exploit failed");

// Use exploit SHELL
if typeof(exploit) == "shell" then exploit.start_terminal

// Use exploit COMPUTER
if typeof(exploit) == "computer" then
	file = exploit.File("/etc/passwd")
	print file.get_content
end if

// Use exploit FILE
if typeof(exploit) == "file" then
	print exploit.path
	print exploit.get_files
	for file in exploit.get_files
		if file.name == "passwd" then print("/nFile /etc/passwd content:/n" + file.get_content)

	end for
end if